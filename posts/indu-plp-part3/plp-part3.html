<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kosuri Lakshmi Indu">
<meta name="dcterms.date" content="2025-04-21">
<meta name="description" content="Reflections on building an end-to-end PLP pipeline in Julia tools - lessons learned, current challenges, and future directions.">

<title>PLP-Pipeline Series Part 3: Lessons Learned, Key Challenges, and What Comes Next – The JuliaHealth Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dbcbc950a42bcaf185fdba3d0ea6113f.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-21ab05999d9ba4f3397b27295ec92d09.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "?"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script data-goatcounter="https://juliahealthblog.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="PLP-Pipeline Series Part 3: Lessons Learned, Key Challenges, and What Comes Next – The JuliaHealth Blog">
<meta property="og:description" content="Reflections on building an end-to-end PLP pipeline in Julia tools - lessons learned, current challenges, and future directions.">
<meta property="og:site_name" content="The JuliaHealth Blog">
<meta property="og:locale" content="en_EN">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../profile.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">The JuliaHealth Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <span class="nav-link">
<span class="menu-text">Write with Us</span>
    </span>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-join-juliahealth" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Join JuliaHealth</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-join-juliahealth">    
        <li>
    <a class="dropdown-item" href="https://julialang.org/slack/"><i class="bi bi-slack" role="img">
</i> 
 <span class="dropdown-text">Slack (#health-and-medicine)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://julialang.zulipchat.com/"><i class="bi bi-lightning-charge-fill" role="img">
</i> 
 <span class="dropdown-text">Julia Zulip</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://discourse.julialang.org/"><i class="bi bi-pencil-square" role="img">
</i> 
 <span class="dropdown-text">Julia Discourse</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/JuliaHealth/JuliaHealthBlog">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/JuliaHealth/JuliaHealthBlog/issues/new/choose">
 <span class="dropdown-text">Report a Bug</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<b>Navigation &amp; Tips:</b>

<ul>
    <li>Press <b>?</b> for search</li>
    <li><b>"&lt;/&gt; Code"</b> for code nav</li>
</ul>

</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction 👋</a>
  <ul class="collapse">
  <li><a href="#recap-of-previous-parts" id="toc-recap-of-previous-parts" class="nav-link" data-scroll-target="#recap-of-previous-parts">Recap of Previous Parts</a></li>
  <li><a href="#reflections-on-the-ohdsi-framework-vs-julia-approach" id="toc-reflections-on-the-ohdsi-framework-vs-julia-approach" class="nav-link" data-scroll-target="#reflections-on-the-ohdsi-framework-vs-julia-approach">Reflections on the OHDSI Framework vs Julia Approach</a></li>
  <li><a href="#model-performance" id="toc-model-performance" class="nav-link" data-scroll-target="#model-performance">Model performance</a></li>
  <li><a href="#lessons-learned" id="toc-lessons-learned" class="nav-link" data-scroll-target="#lessons-learned">Lessons Learned</a></li>
  <li><a href="#key-challenges-faced" id="toc-key-challenges-faced" class="nav-link" data-scroll-target="#key-challenges-faced">Key Challenges Faced</a></li>
  <li><a href="#next-steps-for-the-pipeline" id="toc-next-steps-for-the-pipeline" class="nav-link" data-scroll-target="#next-steps-for-the-pipeline">Next Steps for the Pipeline</a></li>
  <li><a href="#looking-ahead" id="toc-looking-ahead" class="nav-link" data-scroll-target="#looking-ahead">Looking Ahead</a></li>
  </ul></li>
  <li><a href="#thank-you" id="toc-thank-you" class="nav-link" data-scroll-target="#thank-you">Thank You</a>
  <ul class="collapse">
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/JuliaHealth/JuliaHealthBlog/edit/main/posts/indu-plp-part3/plp-part3.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/JuliaHealth/JuliaHealthBlog/issues/new/choose" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">PLP-Pipeline Series Part 3: Lessons Learned, Key Challenges, and What Comes Next</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">patient-level prediction</div>
    <div class="quarto-category">omop cdm</div>
    <div class="quarto-category">observational health</div>
  </div>
  </div>

<div>
  <div class="description">
    Reflections on building an end-to-end PLP pipeline in Julia tools - lessons learned, current challenges, and future directions.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kosuri Lakshmi Indu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 21, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction 👋</h1>
<p>Welcome back to the final part of the blog series on building a Patient-Level Prediction (PLP) Pipeline in Julia using the OMOP Common Data Model (CDM).</p>
<p>In this concluding post, we’ll reflect on the full journey - from cohort definition and feature extraction to preprocessing, modeling, and evaluation. We’ll dig into what worked well, what challenges emerged, and what lessons were learned while building this pipeline from scratch using Julia. This post aims to bring the series full circle, offering insights into the practical realities of working with real-world health data and setting the stage for future work and improvements.</p>
<section id="recap-of-previous-parts" class="level2">
<h2 class="anchored" data-anchor-id="recap-of-previous-parts">Recap of Previous Parts</h2>
<p>In <a href="../indu-plp-part1/plp-part1.qmd"><strong>Part 1</strong></a>, we introduced the motivation and core question driving the pipeline:</p>
<blockquote class="blockquote">
<p>Among patients diagnosed with hypertension, who will go on to develop diabetes?</p>
</blockquote>
<p>We chose this prediction problem because of its clinical relevance and because hypertension and diabetes are both common chronic conditions with strong associations in literature.</p>
<p>To extract patient cohorts, we used <a href="https://github.com/MechanicalRabbit/OHDSICohortExpressions.jl"><code>OHDSICohortExpressions.jl</code></a>, which allowed us to define concept sets and logic for cohort inclusion and exclusion. For example, the hypertension target cohort included patients with a confirmed hypertension diagnosis, and the outcome cohort included those later diagnosed with diabetes.</p>
<p>In <a href="../indu-plp-part2/plp-part2.qmd"><strong>Part 2</strong></a>, we built a modular pipeline using the Julia ecosystem:</p>
<ul>
<li><strong>Feature extraction</strong> involved pulling demographic, condition, drug, and visit data, encoding it as binary presence indicators.</li>
<li><strong>Preprocessing</strong> included handling missing values, one-hot encoding, normalization, and creating train-test splits.</li>
<li><strong>Model training</strong> used the <code>MLJ.jl</code> framework to train logistic regression, random forest, and XGBoost models.</li>
<li><strong>Evaluation</strong> involved computing AUC and accuracy for binary classification.</li>
</ul>
</section>
<section id="reflections-on-the-ohdsi-framework-vs-julia-approach" class="level2">
<h2 class="anchored" data-anchor-id="reflections-on-the-ohdsi-framework-vs-julia-approach">Reflections on the OHDSI Framework vs Julia Approach</h2>
<p>The OHDSI ecosystem, particularly its <a href="https://github.com/OHDSI/PatientLevelPrediction"><code>PatientLevelPrediction</code></a> package in R, offers an end-to-end solution that integrates tightly with ATLAS and standardized vocabularies. It handles cohort creation, covariate extraction, modeling, and visualization all in one environment.</p>
<p>In contrast, building this pipeline in Julia offered greater flexibility by composing modular packages for each step from cohort extraction and feature engineering to model training and evaluation—rather than relying on a single integrated tool like OHDSI’s <code>PatientLevelPrediction</code> package in R. While this required more manual implementation, it gave me deeper insight into how design decisions impacted performance and reproducibility. Using Julia’s ecosystem (e.g., <code>DataFrames.jl</code>, <code>MLJ.jl</code>), I could customize the workflow and experiment with different modeling strategies. To give a complete picture of the pipeline’s outcome, I’ve included relevant performance statistics and visualizations, even where the results were suboptimal.</p>
</section>
<section id="model-performance" class="level2">
<h2 class="anchored" data-anchor-id="model-performance">Model performance</h2>
<p>After preprocessing the features and labels, model performance was not as strong as expected. The AUC values for the classifiers were relatively low for the models:</p>
<ul>
<li>Logistic Regression (L1-regularized)</li>
<li>Random Forest: AUC</li>
<li>XGBoost: AUC</li>
</ul>
<p>These unexpectedly low model performances prompted a deeper investigation into the root causes. The primary issue was that the <strong>data available in the CDM was not well-suited</strong> to answer the research question: “From those diagnosed with hypertension, who goes on to develop diabetes?”</p>
<p>Temporal context was also missing, as the features extracted were basic binary indicators that did not reflect the timing or frequency of clinical events. The one-year prediction window might have been too narrow for diabetes to develop meaningfully after a hypertension diagnosis.</p>
<p>Additionally, many patients had very limited observational data before the index date, reducing the reliability of the features. Altogether, the problem lay not with the modeling itself but with the mismatch between the available data and the clinical nuances of the question being asked.</p>
</section>
<section id="lessons-learned" class="level2">
<h2 class="anchored" data-anchor-id="lessons-learned">Lessons Learned</h2>
<p>This project highlighted that Julia is well-suited for observational health research workflows. Its strong data ecosystem (<code>DataFrames.jl</code>, <code>DuckDB.jl</code>, <code>CSV.jl</code>), rich machine learning interfaces (<code>MLJ.jl</code>), and increasing support from domain-specific packages like <code>OHDSICohortExpressions.jl</code> make it a compelling environment for building transparent, customizable pipelines. Unlike black-box tools, Julia allows full control over every stage-from data access to model tuning-encouraging deeper understanding and reproducibility.</p>
<p>From this experience, several lessons became evident:</p>
<ul>
<li>Even with a standardized data model like OMOP CDM, <strong>cohort construction requires clinical reasoning and thorough validation</strong>. Poorly defined cohorts can introduce significant noise and reduce the quality of the learning task.</li>
<li><strong>Simple features such as binary flags often fail</strong> to capture the complex temporal and contextual dynamics in longitudinal health data.</li>
<li><strong>Model performance depends on the entire pipeline</strong>, not just the algorithm. Label noise, data completeness, and preprocessing choices all significantly impact the results.</li>
<li><strong>Reproducibility is essential</strong>-having modular code and clearly defined steps ensures that results can be validated, shared, and extended by others in the community.</li>
</ul>
</section>
<section id="key-challenges-faced" class="level2">
<h2 class="anchored" data-anchor-id="key-challenges-faced">Key Challenges Faced</h2>
<p>Throughout the process, we encountered several technical and conceptual challenges:</p>
<p>The most critical issue lay in the <strong>quality and structure of the data itself</strong>. Many patients had sparse or short observation periods, which meant that only limited clinical history was available before the cohort entry date.</p>
<p>This directly affected the utility of the extracted features. On the modeling side, integrating with <code>MLJ.jl</code> required careful setup, especially when handling missing values, categorical encodings, and class imbalance.</p>
<br>
<center>
<p><img src="./mlj.png" class="img-fluid"></p>
MLJ.jl
</center>
<p><br></p>
<p>Feature engineering was another bottleneck, since most features were binary flags or simple counts that did not capture clinical nuance or temporal dynamics. Preprocessing steps like normalization and imputation also needed fine-tuning and often had to be manually adjusted per model.</p>
</section>
<section id="next-steps-for-the-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="next-steps-for-the-pipeline">Next Steps for the Pipeline</h2>
<p>To address the above challenges and build on the current foundation, the next steps could include:</p>
<ul>
<li><strong>Refining cohort definitions</strong>:
<ul>
<li>Ensure outcome definitions require multiple confirmations or additional evidence (e.g., lab tests or prescriptions).</li>
<li>Consider longer lookahead and lookback windows for a richer temporal view of patient history.</li>
</ul></li>
<li><strong>Improving feature extraction</strong>:
<ul>
<li>Add time-to-event features, visit counts, or recency indicators.</li>
<li>Explore embedding-based representations of condition or drug sequences.</li>
</ul></li>
<li><strong>Extending evaluation</strong>:
<ul>
<li>Use calibration plots, ROC/PR curves, and stratified performance metrics.</li>
<li>Evaluate model fairness across subgroups (age, sex, race if available).</li>
</ul></li>
<li><strong>Visualization and reporting</strong>:
<ul>
<li>Add support for plotting cohort sizes, timelines, and model performance.</li>
<li>Use libraries like <code>Makie.jl</code> or <code>VegaLite.jl</code> to generate interactive plots.</li>
</ul></li>
<li><strong>Code modularization</strong>:
<ul>
<li>Refactor the current pipeline into reusable, well-documented modules.</li>
<li>Provide clear examples, unit tests, and reproducible workflows.</li>
</ul></li>
</ul>
</section>
<section id="looking-ahead" class="level2">
<h2 class="anchored" data-anchor-id="looking-ahead">Looking Ahead</h2>
<p>This project was both a technical and conceptual deep dive into building patient-level prediction tools from scratch in Julia. Although the first iteration of the models underperformed, the experience revealed what is required to do such predictive modeling properly: validated cohorts, thoughtful feature engineering, strong modeling baselines, and interpretable results.</p>
<p>The long-term goal is to turn this exploratory code into a robust, Julia-native package for PLP tasks - one that integrates with existing JuliaHealth tools, supports OMOP CDM datasets, and provides flexibility for building custom pipelines. By aligning more closely with OHDSI definitions and adding diagnostics, this could serve as both a research tool and an educational resource.</p>
<p>To improve interpretability, we could also incorporate visualization into the pipeline using tools like <code>Makie.jl</code> or <code>VegaLite.jl</code>. Some of the visualizations that can enhance understanding include:</p>
<ul>
<li>Timeline plots showing cohort entry and outcome windows</li>
<li>Feature density plots to understand sparsity</li>
<li>ROC and PR curves to assess model quality</li>
<li>Feature importance summaries from tree-based models</li>
</ul>
<p>These will not only support model tuning but also help communicate findings to clinicians and researchers.</p>
<p>Eventually, this project could serve as a foundation for a Julia-native PLP toolkit, or at least a template for others interested in working with observational health data in Julia.</p>
</section>
</section>
<section id="thank-you" class="level1">
<h1>Thank You</h1>
<p>If you’ve followed the blog series till now - thank you. Your time and interest in this work mean a lot. I hope this series helped you understand what it takes to build predictive models using real-world health data, and how Julia can support that process in a flexible and open way.</p>
<p>Feel free to connect connect with me on <a href="https://www.linkedin.com/in/kosuri-indu/"><strong>LinkedIn</strong></a> and follow me on <a href="https://github.com/kosuri-indu"><strong>GitHub</strong></a></p>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>Thanks to Jacob Zelko for his mentorship, clarity, and constant feedback throughout the project. I also thank the JuliaHealth community for building an ecosystem where composable science can thrive.</p>
<p><a href="https://jacobzelko.com">Jacob S. Zelko</a>: aka, <a href="https://github.com/TheCedarPrince">TheCedarPrince</a></p>
<p><em>Note: This blog post was drafted with the assistance of LLM technologies to support grammar, clarity and structure.</em></p>


<!-- -->

</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{lakshmi_indu2025,
  author = {Lakshmi Indu, Kosuri},
  title = {PLP-Pipeline {Series} {Part} 3: {Lessons} {Learned,} {Key}
    {Challenges,} and {What} {Comes} {Next}},
  date = {2025-04-21},
  url = {https://juliahealth.org/JuliaHealthBlog/posts/indu-plp-part3/plp-part3.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-lakshmi_indu2025" class="csl-entry quarto-appendix-citeas" role="listitem">
<div class="">K.
Lakshmi Indu, <span>“PLP-Pipeline Series Part 3: Lessons Learned, Key
Challenges, and What Comes Next,”</span> Apr. 21, 2025. Available: <a href="https://juliahealth.org/JuliaHealthBlog/posts/indu-plp-part3/plp-part3.html">https://juliahealth.org/JuliaHealthBlog/posts/indu-plp-part3/plp-part3.html</a></div>
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/juliahealth\.org\/JuliaHealthBlog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="JuliaHealth/JuliaHealthBlog" issue-term="title" theme="github-dark" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb1" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">---</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="an">title:</span><span class="co"> "PLP-Pipeline Series Part 3: Lessons Learned, Key Challenges, and What Comes Next"</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="an">description:</span><span class="co"> "Reflections on building an end-to-end PLP pipeline in Julia tools - lessons learned, current challenges, and future directions."  </span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="an">author:</span><span class="co"> "Kosuri Lakshmi Indu"</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="an">date:</span><span class="co"> "4/21/2025"</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="an">bibliography:</span><span class="co"> ./references.bib</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="an">csl:</span><span class="co"> ./../../ieee-with-url.csl</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="an">engine:</span><span class="co"> julia</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="an">image:</span><span class="co"> false</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="an">categories:</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">  - patient-level prediction</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">  - omop cdm</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">  - observational health</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">---</span></span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="fu"># Introduction 👋</span></span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a>Welcome back to the final part of the blog series on building a Patient-Level Prediction (PLP) Pipeline in Julia using the OMOP Common Data Model (CDM).</span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a>In this concluding post, we'll reflect on the full journey - from cohort definition and feature extraction to preprocessing, modeling, and evaluation. We'll dig into what worked well, what challenges emerged, and what lessons were learned while building this pipeline from scratch using Julia. This post aims to bring the series full circle, offering insights into the practical realities of working with real-world health data and setting the stage for future work and improvements.</span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="fu">## Recap of Previous Parts</span></span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a>In <span class="co">[</span><span class="ot">**Part 1**</span><span class="co">](../indu-plp-part1/plp-part1.qmd)</span>, we introduced the motivation and core question driving the pipeline:</span>
<span id="cb1-26"><a href="#cb1-26"></a></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="at">&gt; Among patients diagnosed with hypertension, who will go on to develop diabetes?</span></span>
<span id="cb1-28"><a href="#cb1-28"></a></span>
<span id="cb1-29"><a href="#cb1-29"></a>We chose this prediction problem because of its clinical relevance and because hypertension and diabetes are both common chronic conditions with strong associations in literature.</span>
<span id="cb1-30"><a href="#cb1-30"></a></span>
<span id="cb1-31"><a href="#cb1-31"></a>To extract patient cohorts, we used <span class="co">[</span><span class="ot">`OHDSICohortExpressions.jl`</span><span class="co">](https://github.com/MechanicalRabbit/OHDSICohortExpressions.jl)</span>, which allowed us to define concept sets and logic for cohort inclusion and exclusion. For example, the hypertension target cohort included patients with a confirmed hypertension diagnosis, and the outcome cohort included those later diagnosed with diabetes.</span>
<span id="cb1-32"><a href="#cb1-32"></a></span>
<span id="cb1-33"><a href="#cb1-33"></a></span>
<span id="cb1-34"><a href="#cb1-34"></a>In <span class="co">[</span><span class="ot">**Part 2**</span><span class="co">](../indu-plp-part2/plp-part2.qmd)</span>, we built a modular pipeline using the Julia ecosystem:</span>
<span id="cb1-35"><a href="#cb1-35"></a></span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="ss">- </span>**Feature extraction** involved pulling demographic, condition, drug, and visit data, encoding it as binary presence indicators.</span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="ss">- </span>**Preprocessing** included handling missing values, one-hot encoding, normalization, and creating train-test splits.</span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="ss">- </span>**Model training** used the <span class="in">`MLJ.jl`</span> framework to train logistic regression, random forest, and XGBoost models.</span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="ss">- </span>**Evaluation** involved computing AUC and accuracy for binary classification.</span>
<span id="cb1-40"><a href="#cb1-40"></a></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="fu">## Reflections on the OHDSI Framework vs Julia Approach</span></span>
<span id="cb1-42"><a href="#cb1-42"></a></span>
<span id="cb1-43"><a href="#cb1-43"></a>The OHDSI ecosystem, particularly its <span class="co">[</span><span class="ot">`PatientLevelPrediction`</span><span class="co">](https://github.com/OHDSI/PatientLevelPrediction)</span> package in R, offers an end-to-end solution that integrates tightly with ATLAS and standardized vocabularies. It handles cohort creation, covariate extraction, modeling, and visualization all in one environment.</span>
<span id="cb1-44"><a href="#cb1-44"></a></span>
<span id="cb1-45"><a href="#cb1-45"></a>In contrast, building this pipeline in Julia offered greater flexibility by composing modular packages for each step from cohort extraction and feature engineering to model training and evaluation—rather than relying on a single integrated tool like OHDSI’s <span class="in">`PatientLevelPrediction`</span> package in R. While this required more manual implementation, it gave me deeper insight into how design decisions impacted performance and reproducibility. Using Julia’s ecosystem (e.g., <span class="in">`DataFrames.jl`</span>, <span class="in">`MLJ.jl`</span>), I could customize the workflow and experiment with different modeling strategies. To give a complete picture of the pipeline’s outcome, I’ve included relevant performance statistics and visualizations, even where the results were suboptimal.</span>
<span id="cb1-46"><a href="#cb1-46"></a></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="fu">## Model performance</span></span>
<span id="cb1-48"><a href="#cb1-48"></a></span>
<span id="cb1-49"><a href="#cb1-49"></a>After preprocessing the features and labels, model performance was not as strong as expected. The AUC values for the classifiers were relatively low for the models:</span>
<span id="cb1-50"><a href="#cb1-50"></a></span>
<span id="cb1-51"><a href="#cb1-51"></a><span class="ss">- </span>Logistic Regression (L1-regularized)</span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="ss">- </span>Random Forest: AUC </span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="ss">- </span>XGBoost: AUC</span>
<span id="cb1-54"><a href="#cb1-54"></a></span>
<span id="cb1-55"><a href="#cb1-55"></a>These unexpectedly low model performances prompted a deeper investigation into the root causes. The primary issue was that the **data available in the CDM was not well-suited** to answer the research question: “From those diagnosed with hypertension, who goes on to develop diabetes?” </span>
<span id="cb1-56"><a href="#cb1-56"></a></span>
<span id="cb1-57"><a href="#cb1-57"></a>Temporal context was also missing, as the features extracted were basic binary indicators that did not reflect the timing or frequency of clinical events. The one-year prediction window might have been too narrow for diabetes to develop meaningfully after a hypertension diagnosis. </span>
<span id="cb1-58"><a href="#cb1-58"></a></span>
<span id="cb1-59"><a href="#cb1-59"></a>Additionally, many patients had very limited observational data before the index date, reducing the reliability of the features. Altogether, the problem lay not with the modeling itself but with the mismatch between the available data and the clinical nuances of the question being asked.</span>
<span id="cb1-60"><a href="#cb1-60"></a></span>
<span id="cb1-61"><a href="#cb1-61"></a><span class="fu">## Lessons Learned</span></span>
<span id="cb1-62"><a href="#cb1-62"></a></span>
<span id="cb1-63"><a href="#cb1-63"></a>This project highlighted that Julia is well-suited for observational health research workflows. Its strong data ecosystem (<span class="in">`DataFrames.jl`</span>, <span class="in">`DuckDB.jl`</span>, <span class="in">`CSV.jl`</span>), rich machine learning interfaces (<span class="in">`MLJ.jl`</span>), and increasing support from domain-specific packages like <span class="in">`OHDSICohortExpressions.jl`</span> make it a compelling environment for building transparent, customizable pipelines. Unlike black-box tools, Julia allows full control over every stage-from data access to model tuning-encouraging deeper understanding and reproducibility.</span>
<span id="cb1-64"><a href="#cb1-64"></a></span>
<span id="cb1-65"><a href="#cb1-65"></a>From this experience, several lessons became evident:</span>
<span id="cb1-66"><a href="#cb1-66"></a></span>
<span id="cb1-67"><a href="#cb1-67"></a><span class="ss">- </span>Even with a standardized data model like OMOP CDM, **cohort construction requires clinical reasoning and thorough validation**. Poorly defined cohorts can introduce significant noise and reduce the quality of the learning task.</span>
<span id="cb1-68"><a href="#cb1-68"></a><span class="ss">- </span>**Simple features such as binary flags often fail** to capture the complex temporal and contextual dynamics in longitudinal health data.</span>
<span id="cb1-69"><a href="#cb1-69"></a><span class="ss">- </span>**Model performance depends on the entire pipeline**, not just the algorithm. Label noise, data completeness, and preprocessing choices all significantly impact the results.</span>
<span id="cb1-70"><a href="#cb1-70"></a><span class="ss">- </span>**Reproducibility is essential**-having modular code and clearly defined steps ensures that results can be validated, shared, and extended by others in the community.</span>
<span id="cb1-71"><a href="#cb1-71"></a></span>
<span id="cb1-72"><a href="#cb1-72"></a></span>
<span id="cb1-73"><a href="#cb1-73"></a><span class="fu">## Key Challenges Faced</span></span>
<span id="cb1-74"><a href="#cb1-74"></a></span>
<span id="cb1-75"><a href="#cb1-75"></a>Throughout the process, we encountered several technical and conceptual challenges:</span>
<span id="cb1-76"><a href="#cb1-76"></a></span>
<span id="cb1-77"><a href="#cb1-77"></a>The most critical issue lay in the **quality and structure of the data itself**. Many patients had sparse or short observation periods, which meant that only limited clinical history was available before the cohort entry date. </span>
<span id="cb1-78"><a href="#cb1-78"></a></span>
<span id="cb1-79"><a href="#cb1-79"></a>This directly affected the utility of the extracted features. On the modeling side, integrating with <span class="in">`MLJ.jl`</span> required careful setup, especially when handling missing values, categorical encodings, and class imbalance.</span>
<span id="cb1-80"><a href="#cb1-80"></a></span>
<span id="cb1-81"><a href="#cb1-81"></a>&lt;br&gt;</span>
<span id="cb1-82"><a href="#cb1-82"></a>&lt;center&gt;</span>
<span id="cb1-83"><a href="#cb1-83"></a>  <span class="al">![](./mlj.png)</span></span>
<span id="cb1-84"><a href="#cb1-84"></a></span>
<span id="cb1-85"><a href="#cb1-85"></a>  MLJ.jl</span>
<span id="cb1-86"><a href="#cb1-86"></a>&lt;/center&gt;</span>
<span id="cb1-87"><a href="#cb1-87"></a>&lt;br&gt;</span>
<span id="cb1-88"><a href="#cb1-88"></a></span>
<span id="cb1-89"><a href="#cb1-89"></a>Feature engineering was another bottleneck, since most features were binary flags or simple counts that did not capture clinical nuance or temporal dynamics. Preprocessing steps like normalization and imputation also needed fine-tuning and often had to be manually adjusted per model. </span>
<span id="cb1-90"><a href="#cb1-90"></a></span>
<span id="cb1-91"><a href="#cb1-91"></a><span class="fu">## Next Steps for the Pipeline</span></span>
<span id="cb1-92"><a href="#cb1-92"></a></span>
<span id="cb1-93"><a href="#cb1-93"></a>To address the above challenges and build on the current foundation, the next steps could include:</span>
<span id="cb1-94"><a href="#cb1-94"></a></span>
<span id="cb1-95"><a href="#cb1-95"></a><span class="ss">- </span>**Refining cohort definitions**:</span>
<span id="cb1-96"><a href="#cb1-96"></a><span class="ss">  - </span>Ensure outcome definitions require multiple confirmations or additional evidence (e.g., lab tests or prescriptions).</span>
<span id="cb1-97"><a href="#cb1-97"></a><span class="ss">  - </span>Consider longer lookahead and lookback windows for a richer temporal view of patient history.</span>
<span id="cb1-98"><a href="#cb1-98"></a><span class="ss">- </span>**Improving feature extraction**:</span>
<span id="cb1-99"><a href="#cb1-99"></a><span class="ss">  - </span>Add time-to-event features, visit counts, or recency indicators.</span>
<span id="cb1-100"><a href="#cb1-100"></a><span class="ss">  - </span>Explore embedding-based representations of condition or drug sequences.</span>
<span id="cb1-101"><a href="#cb1-101"></a><span class="ss">- </span>**Extending evaluation**:</span>
<span id="cb1-102"><a href="#cb1-102"></a><span class="ss">  - </span>Use calibration plots, ROC/PR curves, and stratified performance metrics.</span>
<span id="cb1-103"><a href="#cb1-103"></a><span class="ss">  - </span>Evaluate model fairness across subgroups (age, sex, race if available).</span>
<span id="cb1-104"><a href="#cb1-104"></a><span class="ss">- </span>**Visualization and reporting**:</span>
<span id="cb1-105"><a href="#cb1-105"></a><span class="ss">  - </span>Add support for plotting cohort sizes, timelines, and model performance.</span>
<span id="cb1-106"><a href="#cb1-106"></a><span class="ss">  - </span>Use libraries like <span class="in">`Makie.jl`</span> or <span class="in">`VegaLite.jl`</span> to generate interactive plots.</span>
<span id="cb1-107"><a href="#cb1-107"></a><span class="ss">- </span>**Code modularization**:</span>
<span id="cb1-108"><a href="#cb1-108"></a><span class="ss">  - </span>Refactor the current pipeline into reusable, well-documented modules.</span>
<span id="cb1-109"><a href="#cb1-109"></a><span class="ss">  - </span>Provide clear examples, unit tests, and reproducible workflows.</span>
<span id="cb1-110"><a href="#cb1-110"></a></span>
<span id="cb1-111"><a href="#cb1-111"></a><span class="fu">## Looking Ahead</span></span>
<span id="cb1-112"><a href="#cb1-112"></a></span>
<span id="cb1-113"><a href="#cb1-113"></a>This project was both a technical and conceptual deep dive into building patient-level prediction tools from scratch in Julia. Although the first iteration of the models underperformed, the experience revealed what is required to do such predictive modeling properly: validated cohorts, thoughtful feature engineering, strong modeling baselines, and interpretable results.</span>
<span id="cb1-114"><a href="#cb1-114"></a></span>
<span id="cb1-115"><a href="#cb1-115"></a>The long-term goal is to turn this exploratory code into a robust, Julia-native package for PLP tasks - one that integrates with existing JuliaHealth tools, supports OMOP CDM datasets, and provides flexibility for building custom pipelines. By aligning more closely with OHDSI definitions and adding diagnostics, this could serve as both a research tool and an educational resource.</span>
<span id="cb1-116"><a href="#cb1-116"></a></span>
<span id="cb1-117"><a href="#cb1-117"></a>To improve interpretability, we could also incorporate visualization into the pipeline using tools like <span class="in">`Makie.jl`</span> or <span class="in">`VegaLite.jl`</span>. Some of the visualizations that can enhance understanding include:</span>
<span id="cb1-118"><a href="#cb1-118"></a></span>
<span id="cb1-119"><a href="#cb1-119"></a><span class="ss">- </span>Timeline plots showing cohort entry and outcome windows</span>
<span id="cb1-120"><a href="#cb1-120"></a><span class="ss">- </span>Feature density plots to understand sparsity</span>
<span id="cb1-121"><a href="#cb1-121"></a><span class="ss">- </span>ROC and PR curves to assess model quality</span>
<span id="cb1-122"><a href="#cb1-122"></a><span class="ss">- </span>Feature importance summaries from tree-based models</span>
<span id="cb1-123"><a href="#cb1-123"></a></span>
<span id="cb1-124"><a href="#cb1-124"></a>These will not only support model tuning but also help communicate findings to clinicians and researchers.</span>
<span id="cb1-125"><a href="#cb1-125"></a></span>
<span id="cb1-126"><a href="#cb1-126"></a>Eventually, this project could serve as a foundation for a Julia-native PLP toolkit, or at least a template for others interested in working with observational health data in Julia.</span>
<span id="cb1-127"><a href="#cb1-127"></a></span>
<span id="cb1-128"><a href="#cb1-128"></a><span class="fu"># Thank You</span></span>
<span id="cb1-129"><a href="#cb1-129"></a></span>
<span id="cb1-130"><a href="#cb1-130"></a>If you’ve followed the blog series till now - thank you. Your time and interest in this work mean a lot. I hope this series helped you understand what it takes to build predictive models using real-world health data, and how Julia can support that process in a flexible and open way.</span>
<span id="cb1-131"><a href="#cb1-131"></a></span>
<span id="cb1-132"><a href="#cb1-132"></a>Feel free to connect  connect with me on <span class="co">[</span><span class="ot">**LinkedIn**</span><span class="co">](https://www.linkedin.com/in/kosuri-indu/)</span> and follow me on <span class="co">[</span><span class="ot">**GitHub**</span><span class="co">](https://github.com/kosuri-indu)</span></span>
<span id="cb1-133"><a href="#cb1-133"></a></span>
<span id="cb1-134"><a href="#cb1-134"></a><span class="fu">## Acknowledgements</span></span>
<span id="cb1-135"><a href="#cb1-135"></a></span>
<span id="cb1-136"><a href="#cb1-136"></a>Thanks to Jacob Zelko for his mentorship, clarity, and constant feedback throughout the project. I also thank the JuliaHealth community for building an ecosystem where composable science can thrive.</span>
<span id="cb1-137"><a href="#cb1-137"></a></span>
<span id="cb1-138"><a href="#cb1-138"></a><span class="co">[</span><span class="ot">Jacob S. Zelko</span><span class="co">](https://jacobzelko.com)</span>: aka, <span class="co">[</span><span class="ot">TheCedarPrince</span><span class="co">](https://github.com/TheCedarPrince)</span></span>
<span id="cb1-139"><a href="#cb1-139"></a></span>
<span id="cb1-140"><a href="#cb1-140"></a>_Note: This blog post was drafted with the assistance of LLM technologies to support grammar, clarity and structure._</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, JuliaHealth.</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/JuliaHealth/JuliaHealthBlog">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/c/TheJuliaLanguage">
      <i class="bi bi-youtube" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://julialang.org/slack/">
      <i class="bi bi-slack" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/julialanguage">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/JuliaHealth/JuliaHealthBlog/edit/main/posts/indu-plp-part3/plp-part3.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/JuliaHealth/JuliaHealthBlog/issues/new/choose" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>